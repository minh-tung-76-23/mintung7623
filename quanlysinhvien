#include<stdio.h>
#include<string.h>
	struct sinhvien {
		int msv; 
		float DiemToan, DiemTriet, DiemC, Dtb;
		char HoTen[50], GioiTinh[20], NgaySinh[20], Lop[20]; 
	}; 
	
	typedef sinhvien Sv;
	
	void nhap(Sv arr[], int n) {
		for (int i=0; i<n ; i++) {
			fflush(stdin);
			printf ("\n\tSinh vien thu %d", i+1);
			printf("\nNhap MSV:");scanf("%d", &arr[i].msv);
			fflush(stdin);
			printf ("\nNhap ho ten sinh vien:"); gets(arr[i].HoTen);
			printf("\nGioi tinh:"); gets (arr[i].GioiTinh);
			printf ("\nNgay sinh:"); gets(arr[i].NgaySinh);
			printf ("\nLop:"); gets(arr[i].Lop);
			printf ("\nDiem Toan cao cap:"); scanf("%f", &arr[i].DiemToan);
			printf ("\nDiem Triet hoc:"); scanf("%f", &arr[i].DiemTriet);
			printf ("\nDiem Co so lap trinh C:"); scanf("%f", &arr[i].DiemC);
			fflush(stdin);
		} 
		printf("\n<--------------------------------------------------------->\n"); 
	} 
	
	void xuat(Sv arr[], int n) {
		printf("\n-------------------------------------------------------------------------------------------------------------------------");
		printf("\n|%-8s|%-22s|%-10s|%-10s|%-13s|%-15s|%-15s |%-15s|", "MSV","Ho ten","Gioi tinh","Ngay Sinh","Lop","Diem Toan cao cap","Diem triet","Diem lap trinh C");
		printf("\n-------------------------------------------------------------------------------------------------------------------------");
		for(int i=0; i<n; i++) {
			printf("\n|%-8d|%-22s|%-10s|%-10s|%-13s|%-16.2f |%-16.2f|%-16.2f| ", 
			    arr[i].msv, arr[i].HoTen, arr[i].GioiTinh, arr[i].NgaySinh,arr[i].Lop, arr[i].DiemToan, arr[i].DiemTriet, arr[i].DiemC);
		} 
		printf("\n-------------------------------------------------------------------------------------------------------------------------");
		printf("\n\t<----->\n");
	} 
	
	void xuatTheoDtb(Sv arr[], int n) {
		printf("\n--------------------------------------------------------------------------------------------------------------------------------");
		printf("\n|%-8s|%-22s|%-10s|%-10s|%-13s|%-15s|%-15s |%-15s|%-5s|", "MSV","Ho ten","Gioi tinh","Ngay Sinh","Lop","Diem Toan cao cap","Diem triet","Diem lap trinh C", "DiemTB");
		printf("\n--------------------------------------------------------------------------------------------------------------------------------");
		for(int i=0; i<n; i++) {
			printf("\n|%-8d|%-22s|%-10s|%-10s|%-13s|%-16.2f |%-16.2f|%-16.2f|%-5.2f | ", 
			    arr[i].msv, arr[i].HoTen, arr[i].GioiTinh, arr[i].NgaySinh,arr[i].Lop, arr[i].DiemToan, arr[i].DiemTriet, arr[i].DiemC, arr[i].Dtb);
		} 
		printf("\n--------------------------------------------------------------------------------------------------------------------------------");
		printf("\n\t<----->\n");
	} 
	
	void TinhDtb(Sv arr[], int n) {
		for (int i=0; i<n; i++) {
			arr[i].Dtb=(arr[i].DiemToan+arr[i].DiemTriet+ arr[i].DiemC)/3;
			printf("\nDTb cua %s la: %.2f", arr[i].HoTen, arr[i].Dtb);	 
		} 
		printf("\n\t<----->\n");
	}
	
	void SapXepTheoDtb(Sv arr[], int n) {
		Sv temp; 
		for (int i=0; i<n; i++) {
			for (int j=i+1; j <n ; ++j) {
				if(arr[i].Dtb > arr[j].Dtb) {
					temp = arr[i];
					arr[i]=arr[j];
					arr[j]= temp;
				}
			}
		}
		printf("\n");
	}
	
	void XepLoai (Sv arr[], int n) {
		for (int i=0; i<n; i++){
			if(arr[i].Dtb >= 8){
				printf("\nSinh vien %s - xep loai Gioi", arr[i].HoTen); 
			} else if(arr[i].Dtb<8 && arr[i].Dtb>= 6.5) {
				printf("\nSinh vien %s - xep loai Kha", arr[i].HoTen);
			} else if(arr[i].Dtb<6.5 && arr[i].Dtb >= 5) {
				printf("\nSinh vien %s - xep loai Trung Binh", arr[i].HoTen);
			} else {
				printf("\nSinh vien %s - xep loai Yeu", arr[i].HoTen);
			} 
		} 
		printf("\n\t<----->\n");
	} 
	
	void ghiFile (Sv arr[], int n, char fileName[]) {
		FILE *fp;
		fp = fopen("quanlysinhvien.txt", "w") ;
		fprintf(fp,"\n|%-8s|%-22s|%-10s|%-10s|%-13s|%-15s|%-15s |%-15s|%-5s|", "MSV","Ho ten","Gioi tinh","Ngay Sinh","Lop","Diem Toan cao cap","Diem triet","Diem lap trinh C", "DiemTB");
		for (int i=0 ; i<n; i++) {
			fprintf(fp, "\n|%-8d|%-22s|%-10s|%-10s|%-13s|%-16.2f |%-16.2f|%-16.2f|%-5.2f | ", 
			    arr[i].msv, arr[i].HoTen, arr[i].GioiTinh, arr[i].NgaySinh,arr[i].Lop, arr[i].DiemToan, arr[i].DiemTriet, arr[i].DiemC, arr[i].Dtb ) ;
		} 
		fclose(fp); 
		printf("\n");
	}
	
	int main() {
		bool daNhap; 
		int choose; 
		char fileName[] = "quanlysinhvien.txt" ;
		while(true) {
			printf("\nMENU QUAN LY SINH VIEN KHOA CONG NGHE THONG TIN") ;
			printf("\n==========================================================");
			printf("\n1. NHAP THONG TIN SINH VIEN") ;
			printf("\n2. XUAT DANH SACH SINH VIEN");
			printf("\n3. TINH DIEM TRUNG BINH SINH VIEN");
			printf("\n4. SAP XEP SINH VIEN THEO THU TU TANG DAN CUA DIEM TRUNG BINH");
			printf("\n5. XEP LOAI SINH VIEN");
			printf("\n6. XUAT DU LIEU SINH VIEN RA FILE");
			printf("\n0. THOAT CHUONG TRINH");
			printf("\n===========================================================");
			printf("\nNhap lua chon :"); scanf("%d", &choose);
			
			if(choose != 1 && choose != 2 && choose != 3 && choose != 4 && choose != 5 && choose != 6 && choose != 0) { 
				printf("\n\tLUA CHON SAI! VUI LONG NHAP LAI!\n"); 
			}
			
			switch(choose) {
				case 1:
					int n;
					Sv sv[1000]; 
					printf ("\n\t==NHAP THONG TIN SINH VIEN==") ;
					printf("\n Nhap so luong sinh vien:"); scanf("%d", &n);
					nhap(sv, n); 
					daNhap=true ; 
				break;
				
				case 2: 
					if (daNhap) {
						printf("\n\t==DANH SACH SINH VIEN==");
						xuat(sv, n); 
					} else {
						printf("\n\t--DANH SACH SINH VIEN TRONG!--"); 
					} 		 		
				break; 
				
				case 3:
					if (daNhap) {
						printf("\n\t==TINH DIEM TRUNG BINH SINH VIEN");
						TinhDtb(sv, n); 
					} else {
						printf("\n\t--DANH SACH SINH VIEN TRONG!--");; 
					} 	
				break;
				
				case 4:
					if (daNhap) {
						printf("\n\t==SAP XEP SINH VIEN THEO THU TU TANG DAN CUA DIEM TRUNG BINH==");
						SapXepTheoDtb(sv, n);  
						xuatTheoDtb(sv, n);	 
					} else {
						printf("\n\t--DANH SACH SINH VIEN TRONG!--"); 
					} 			
				break;
				
				case 5:
					if (daNhap) {
						printf("\n\t==XEP LOAI SINH VIEN==");
						XepLoai(sv, n);  
					} else {
						printf("\n\t--DANH SACH SINH VIEN TRONG!--"); 
					} 	 
				break;
				
				case 6:
					if (daNhap) {
						printf("\n\t==IN DANH SACH SINH VIEN VAO FILE==");
						ghiFile(sv, n, fileName) ;
						printf ("\n In danh sach sinh vien vao file %s thanh cong!", fileName) ;
					} else {
						printf("\n\t--DANH SACH SINH VIEN TRONG!--"); 
					} 
				break; 
				
				case 0:
					printf("\n\tBAN DA THOAT CHUONG TRINH!");
					return 0; 
				break; 
			}
		}  
		return 0 ; 
	} 
